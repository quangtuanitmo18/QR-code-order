# Internationalization (i18n)

## Overview
- **Package**: next-intl 4.1+
- **Supported Languages**: Vietnamese (vi), English (en)
- **Default Language**: Vietnamese (vi)
- **Translation Files**: `client/messages/{locale}.json`

## URL Structure

### Locale-Prefixed Routes
All routes are prefixed with the locale:

```
Vietnamese: /vi/...
English: /en/...

Examples:
/vi/login
/vi/manage/dashboard
/en/login
/en/manage/dashboard
```

## Setup

### i18n Routing Configuration

#### client/src/i18n/routing.ts
```typescript
import { defineRouting } from 'next-intl/routing'
import { createSharedPathnamesNavigation } from 'next-intl/navigation'

export const routing = defineRouting({
  locales: ['vi', 'en'],
  defaultLocale: 'vi',
  localePrefix: 'always' // Always show locale in URL
})

// Create navigation helpers
export const { Link, redirect, usePathname, useRouter } = 
  createSharedPathnamesNavigation(routing)
```

#### client/src/i18n/request.ts
```typescript
import { getRequestConfig } from 'next-intl/server'
import { routing } from './routing'

export default getRequestConfig(async ({ locale }) => {
  // Validate locale
  if (!routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale
  }
  
  return {
    messages: (await import(`../../messages/${locale}.json`)).default
  }
})
```

### Middleware Configuration

#### client/src/middleware.ts
```typescript
import createMiddleware from 'next-intl/middleware'
import { routing } from './i18n/routing'

export default createMiddleware(routing)

export const config = {
  // Match all pathnames except for:
  // - /api routes
  // - /_next (Next.js internals)
  // - /_vercel (Vercel internals)
  // - Static files (images, fonts, etc.)
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
}
```

### Root Layout Setup

#### client/src/app/[locale]/layout.tsx
```typescript
import { NextIntlClientProvider } from 'next-intl'
import { getMessages } from 'next-intl/server'
import { notFound } from 'next/navigation'
import { routing } from '@/i18n/routing'

export function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }))
}

export default async function LocaleLayout({
  children,
  params: { locale }
}: {
  children: React.ReactNode
  params: { locale: string }
}) {
  // Validate locale
  if (!routing.locales.includes(locale as any)) {
    notFound()
  }
  
  // Load messages for the locale
  const messages = await getMessages()
  
  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
```

## Translation Files

### Structure
Group translations by feature/page:

#### client/messages/vi.json
```json
{
  "Common": {
    "save": "L∆∞u",
    "cancel": "H·ªßy",
    "delete": "X√≥a",
    "edit": "S·ª≠a",
    "add": "Th√™m",
    "search": "T√¨m ki·∫øm",
    "loading": "ƒêang t·∫£i...",
    "error": "ƒê√£ c√≥ l·ªói x·∫£y ra",
    "success": "Th√†nh c√¥ng"
  },
  "LoginPage": {
    "title": "ƒêƒÉng nh·∫≠p",
    "email": "Email",
    "password": "M·∫≠t kh·∫©u",
    "submit": "ƒêƒÉng nh·∫≠p",
    "forgotPassword": "Qu√™n m·∫≠t kh·∫©u?",
    "emailRequired": "Email l√† b·∫Øt bu·ªôc",
    "emailInvalid": "Email kh√¥ng h·ª£p l·ªá",
    "passwordRequired": "M·∫≠t kh·∫©u l√† b·∫Øt bu·ªôc",
    "loginSuccess": "ƒêƒÉng nh·∫≠p th√†nh c√¥ng",
    "loginError": "Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng"
  },
  "Dashboard": {
    "title": "B·∫£ng ƒëi·ªÅu khi·ªÉn",
    "revenue": "Doanh thu",
    "orders": "ƒê∆°n h√†ng",
    "dishes": "M√≥n ƒÉn",
    "customers": "Kh√°ch h√†ng",
    "todayRevenue": "Doanh thu h√¥m nay",
    "totalOrders": "T·ªïng ƒë∆°n h√†ng",
    "pendingOrders": "ƒê∆°n h√†ng ch·ªù",
    "completedOrders": "ƒê∆°n h√†ng ho√†n th√†nh"
  },
  "Dish": {
    "title": "M√≥n ƒÉn",
    "name": "T√™n m√≥n",
    "price": "Gi√°",
    "description": "M√¥ t·∫£",
    "image": "H√¨nh ·∫£nh",
    "status": "Tr·∫°ng th√°i",
    "available": "C√≤n h√†ng",
    "unavailable": "H·∫øt h√†ng",
    "hidden": "·∫®n",
    "addDish": "Th√™m m√≥n ƒÉn",
    "editDish": "S·ª≠a m√≥n ƒÉn",
    "deleteDish": "X√≥a m√≥n ƒÉn",
    "confirmDelete": "B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m√≥n ƒÉn n√†y?"
  },
  "Order": {
    "title": "ƒê∆°n h√†ng",
    "orderNumber": "S·ªë ƒë∆°n",
    "table": "B√†n",
    "guest": "Kh√°ch",
    "status": "Tr·∫°ng th√°i",
    "total": "T·ªïng ti·ªÅn",
    "createdAt": "Ng√†y t·∫°o",
    "pending": "Ch·ªù x·ª≠ l√Ω",
    "processing": "ƒêang x·ª≠ l√Ω",
    "delivered": "ƒê√£ giao",
    "paid": "ƒê√£ thanh to√°n",
    "rejected": "T·ª´ ch·ªëi",
    "updateStatus": "C·∫≠p nh·∫≠t tr·∫°ng th√°i",
    "viewDetails": "Xem chi ti·∫øt"
  },
  "Validation": {
    "required": "Tr∆∞·ªùng n√†y l√† b·∫Øt bu·ªôc",
    "invalidEmail": "Email kh√¥ng h·ª£p l·ªá",
    "minLength": "ƒê·ªô d√†i t·ªëi thi·ªÉu {min} k√Ω t·ª±",
    "maxLength": "ƒê·ªô d√†i t·ªëi ƒëa {max} k√Ω t·ª±",
    "passwordMismatch": "M·∫≠t kh·∫©u kh√¥ng kh·ªõp",
    "invalidNumber": "Vui l√≤ng nh·∫≠p s·ªë h·ª£p l·ªá",
    "invalidUrl": "URL kh√¥ng h·ª£p l·ªá"
  }
}
```

#### client/messages/en.json
```json
{
  "Common": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "add": "Add",
    "search": "Search",
    "loading": "Loading...",
    "error": "An error occurred",
    "success": "Success"
  },
  "LoginPage": {
    "title": "Login",
    "email": "Email",
    "password": "Password",
    "submit": "Login",
    "forgotPassword": "Forgot password?",
    "emailRequired": "Email is required",
    "emailInvalid": "Invalid email",
    "passwordRequired": "Password is required",
    "loginSuccess": "Login successful",
    "loginError": "Invalid email or password"
  },
  "Dashboard": {
    "title": "Dashboard",
    "revenue": "Revenue",
    "orders": "Orders",
    "dishes": "Dishes",
    "customers": "Customers",
    "todayRevenue": "Today's Revenue",
    "totalOrders": "Total Orders",
    "pendingOrders": "Pending Orders",
    "completedOrders": "Completed Orders"
  },
  "Dish": {
    "title": "Dishes",
    "name": "Dish Name",
    "price": "Price",
    "description": "Description",
    "image": "Image",
    "status": "Status",
    "available": "Available",
    "unavailable": "Unavailable",
    "hidden": "Hidden",
    "addDish": "Add Dish",
    "editDish": "Edit Dish",
    "deleteDish": "Delete Dish",
    "confirmDelete": "Are you sure you want to delete this dish?"
  },
  "Order": {
    "title": "Orders",
    "orderNumber": "Order Number",
    "table": "Table",
    "guest": "Guest",
    "status": "Status",
    "total": "Total",
    "createdAt": "Created At",
    "pending": "Pending",
    "processing": "Processing",
    "delivered": "Delivered",
    "paid": "Paid",
    "rejected": "Rejected",
    "updateStatus": "Update Status",
    "viewDetails": "View Details"
  },
  "Validation": {
    "required": "This field is required",
    "invalidEmail": "Invalid email",
    "minLength": "Minimum length is {min} characters",
    "maxLength": "Maximum length is {max} characters",
    "passwordMismatch": "Passwords do not match",
    "invalidNumber": "Please enter a valid number",
    "invalidUrl": "Invalid URL"
  }
}
```

## Usage in Components

### Server Components
```tsx
import { getTranslations } from 'next-intl/server'

export default async function HomePage() {
  const t = await getTranslations('Dashboard')
  
  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('todayRevenue')}: $1,000</p>
    </div>
  )
}
```

### Client Components
```tsx
'use client'
import { useTranslations } from 'next-intl'

export default function LoginForm() {
  const t = useTranslations('LoginPage')
  
  return (
    <form>
      <h1>{t('title')}</h1>
      <input placeholder={t('email')} />
      <input placeholder={t('password')} type="password" />
      <button>{t('submit')}</button>
    </form>
  )
}
```

### With Variables
```tsx
const t = useTranslations('Validation')

// Translation key: "minLength": "Minimum length is {min} characters"
<p>{t('minLength', { min: 6 })}</p>
// Output: "Minimum length is 6 characters"
```

### Rich Text
```tsx
const t = useTranslations('Common')

<p>
  {t.rich('welcomeMessage', {
    strong: (chunks) => <strong>{chunks}</strong>,
    name: userName
  })}
</p>

// Translation: "welcomeMessage": "Welcome <strong>{name}</strong>!"
```

## Navigation with i18n

### Link Component
```tsx
import { Link } from '@/i18n/routing'

// Automatically adds locale prefix
<Link href="/dashboard">Dashboard</Link>
// Renders: /vi/dashboard or /en/dashboard

<Link href="/dishes/123">View Dish</Link>
// Renders: /vi/dishes/123 or /en/dishes/123
```

### Programmatic Navigation
```tsx
'use client'
import { useRouter } from '@/i18n/routing'

export default function MyComponent() {
  const router = useRouter()
  
  const handleClick = () => {
    router.push('/dashboard')
    // Navigates to /vi/dashboard or /en/dashboard
  }
  
  return <button onClick={handleClick}>Go to Dashboard</button>
}
```

### Server-Side Redirect
```tsx
import { redirect } from '@/i18n/routing'

export default async function MyPage() {
  const isAuthorized = await checkAuth()
  
  if (!isAuthorized) {
    redirect('/login') // Redirects to /vi/login or /en/login
  }
  
  return <div>Content</div>
}
```

## Language Switcher Component

```tsx
'use client'
import { useLocale } from 'next-intl'
import { useRouter, usePathname } from '@/i18n/routing'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'

export default function LanguageSwitcher() {
  const locale = useLocale()
  const router = useRouter()
  const pathname = usePathname()
  
  const handleChange = (newLocale: string) => {
    router.replace(pathname, { locale: newLocale })
  }
  
  return (
    <Select value={locale} onValueChange={handleChange}>
      <SelectTrigger className="w-[120px]">
        <SelectValue />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="vi">üáªüá≥ Ti·∫øng Vi·ªát</SelectItem>
        <SelectItem value="en">üá¨üáß English</SelectItem>
      </SelectContent>
    </Select>
  )
}
```

## Schema Validation with i18n

### Translation Keys in Zod Schema
```typescript
// schemaValidations/auth.schema.ts
import z from 'zod'

export const LoginBody = z.object({
  email: z.string().min(1, { message: 'required' }).email({
    message: 'invalidEmail',
  }),
  password: z.string().min(6, 'minmaxPassword').max(100, 'minmaxPassword'),
}).strict()
```

### Display Translated Errors
```tsx
'use client'
import { useTranslations } from 'next-intl'
import { useForm } from 'react-hook-form'

export default function LoginForm() {
  const t = useTranslations('LoginPage')
  const tValidation = useTranslations('Validation')
  
  const form = useForm({
    resolver: zodResolver(LoginBody)
  })
  
  // Translate error messages
  const getErrorMessage = (error: string) => {
    return tValidation(error) || error
  }
  
  return (
    <form>
      <input {...form.register('email')} />
      {form.formState.errors.email && (
        <p className="text-red-500">
          {getErrorMessage(form.formState.errors.email.message)}
        </p>
      )}
    </form>
  )
}
```

## SEO & Metadata with i18n

```tsx
import { getTranslations } from 'next-intl/server'

export async function generateMetadata({ params: { locale } }: Props) {
  const t = await getTranslations({ locale, namespace: 'Metadata' })
  
  return {
    title: t('title'),
    description: t('description'),
    alternates: {
      languages: {
        'vi': '/vi',
        'en': '/en'
      }
    }
  }
}
```

## Best Practices

1. ‚úÖ **Group translations logically** by feature/page
2. ‚úÖ **Use consistent naming** across languages
3. ‚úÖ **Keep translations in sync** - same keys in all files
4. ‚úÖ **Use namespaces** to organize translations
5. ‚úÖ **Add context comments** for translators
6. ‚úÖ **Test both languages** regularly
7. ‚úÖ **Use variables** for dynamic content
8. ‚úÖ **Keep translations short** when possible
9. ‚úÖ **Handle pluralization** when needed
10. ‚úÖ **Don't hardcode text** - always use translation keys

## Common Pitfalls

‚ùå **Don't** hardcode language-specific text
```tsx
// Bad
<h1>ƒêƒÉng nh·∫≠p</h1>

// Good
<h1>{t('title')}</h1>
```

‚ùå **Don't** use different keys for same concept
```json
// Bad
"cancel": "Cancel",
"cancelButton": "Cancel"

// Good - Reuse same key
"cancel": "Cancel"
```

‚ùå **Don't** forget to add translations for new features
```tsx
// Bad - Untranslated text
<h1>New Feature</h1>

// Good - Add to translation files first
<h1>{t('newFeatureTitle')}</h1>
```

